server {
	listen 8140 ssl;
	server_name <%= @fqdn %> <%= @puppet_server %>;

	location / {
                include           uwsgi_params;
                uwsgi_param       SSL_CLIENT_S_DN $ssl_client_s_dn;
                uwsgi_param       SSL_CLIENT_VERIFY $ssl_client_verify;
                uwsgi_pass        127.0.0.1:8141;
                uwsgi_modifier1   7;
	}

	root                       /etc/puppet/rack/public;

	access_log                 /var/log/nginx/puppet.access.log;
	error_log                  /var/log/nginx/puppet.error.log;

	ssl_certificate            /var/lib/puppet/ssl/certs/<%= @fqdn %>.pem;
	ssl_certificate_key        /var/lib/puppet/ssl/private_keys/<%= @fqdn %>.pem;
	ssl_crl                    /var/lib/puppet/ssl/crl.pem;
	ssl_client_certificate     /var/lib/puppet/ssl/ca/ca_crt.pem;
	ssl_ciphers                EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH:EDH+aRSA:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS:!RC4;
	ssl_prefer_server_ciphers  on;
	ssl_verify_client          optional;
	ssl_verify_depth           1;
	ssl_session_cache          shared:SSL:1m;
	ssl_session_timeout        5m;
}
